<!--
 * @Author: liuwanyong liuwanyong2018@gmail.com
 * @Date: 2022-10-14 23:15:35
 * @LastEditors: liuwanyong liuwanyong2018@gmail.com
 * @LastEditTime: 2022-10-31 23:49:45
 * @FilePath: /http/readme.MD
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AEh
-->

# HTTP 概念构建

## 历史

技术不成熟到成熟，商业价值从无到有到巨大。
版本是 1.1 的时候，形成技术联盟，统一标准，科学规范发展。之前的版本都是不成规矩的，
不被认可的，连草案都不算的，混乱发展时代。
之后就到了浏览器厂商们做庄，定制游戏规则的格局的时代了。
发展越来越成熟，矛盾不断变更。
到 2 版本，再到 3 版本。

## 是什么

是超文本传输协议。
超文本是数据内容。
传输是行为，可以是通讯可以是对话可以是交流。
协议，是规范是约定，是机制规则。
类比于两个人交流获取信息，咋交流了，得有这两个人。这两个人得能听到互相的对话，
他们得听得懂，语言互通吧，得有文化认同基础，说的话的语义得懂。
两个端要进行数据通信，得交流了。
一个端发起请求，指向目标端。如何找到目标端了？
想告诉目标，我想说什么，想要什么了？
目标怎么收到请求了？怎么解读请求了？怎么
返回数据了？请求端怎么接收，怎么解读了？
安全，效率。

### HTML

超文本语言，数据格式规范。

### 浏览器

客户代理，发起请求者，也是发爬虫的。

### CDN

代理服务器做应答的，用缓存技术。效率快。

### 服务器

server ，响应端。

### web service

服务器架构技术，通用的上层标准框架。

### IP

发请求和 回复请求的两个点的地址，这是互联网的 IP 协议规则，在一个网内，每个计算机，服务器，都有自己的独一无二的 IP 值。
为了什么，其实就是找到服务器的地址，因为 不是广播那种类型的发送信息。

IP 用在网络层，用于确定这两个点的地址，发送和回复消息可以更高效。每个请求回复数据包，都要在网络层加入 IP 地址。

### UDP

数据包因为 IP 协议，可以被发送到目标的点上了。新的问题是，数据包被计算机或者服务器接受到了，包给哪个程序处理了？
再加一个程序接收的协议，每个程序都要有个身份 ID 不就行了。
实际上这个 ID 是端口号，是对应应用程序的 ID 标识。
涉及到的逻辑放入了传输层。数据包到了传输层，就进行这层的 ID 打包装或者提取识别。
这个协议很简单，很快，但是传输大文件分包传输时，容易丢包。
常用于实时视频在线游戏。

### TCP

相比于 UDP，TCP 是为了保证包的安全和完整的协议，也是传输层的协议。
TCP（Transmission Control Protocol，传输控制
协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。相对于 UDP，TCP 有
下面两个特点:
对于数据包丢失的情况，TCP 提供重传机制；
TCP 引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件。
和 UDP 头一样，TCP 头除了包含了目标端口和本机端口号外，还提供了用于排序的序列
号，以便接收端通过序号来重排数据包。

-  先三次握手建立可靠可信的链接；
-  然后分包发送数据包，每个包都有序号，便于排序；
-  接收端接收到哪个包要回复收到了哪个包了，规定时间内发送端没有收到默认要超时
   的包的回复，就默认它失败了，重新发送；
-  接收端收到所有包了，可以根据序号重组完整包；
-  第四次握手，通知双方中断连接。

保证了数据完整可靠，但是时间会很长，4 次握手，回复包收到，就多了一倍的包效果。

### DNS/IP

IP 确实可以确定对话双方的地址，实现沟通交流的可能。IP 本身也有自己的协议规范和值，目前是 v4 版，以后是 v6 版。用 4 个”."分割，如”192.168.0.1“。
但是人对这种 IP 值是懵逼的，没有规律没有关联，无法便捷记忆。
出现了 DNS，域名系统。
给 IP 取个名字，靠这个名字来指代 IP 值。
域名是主机名。域名跟 IP 是映射关系。
人对域名很容易有感觉有记忆，有意识。人去拿 域名，域名通过域名解析，找到域名指代的 IP。
然后人对 IP 指代的目的地服务器有了感觉了。
域名解析也是靠本地的 DNS 服务器到上层 DNS 服务器一直递归到解析出来为止。

### URI/URL

通过 DNS、IP，可以到目标服务器了，但是服务器上 有很多的文件和资源数据，如何定位我想要的那个？
URI，统一资源标识符，唯一标记网络上的资源。URI 的一个变种就是 URL，统一资源定位符。
几乎一样，不做区分。

<code>http://nginx.org/en/download.html</code>

-  http 协议
-  Nginx.org host ，DNS
-  en/download.html 路径

### HTTPS

http 是明文传输，不加密，无隐私安全。
加密了的 http 就是 HTTPS，多了一个加密协议 SSL/TLS。
最新的密码学技术，
对称加密，非对称加密，数字证书，数字签名等技术。创建一个安全的秘密通道传输数据。

### 代理

中转站，前面的 CDN 就是。可以代理用户端或者服务器端。
可以做负载均衡，内容缓存，数据处理加密等，可以做安全防护，隐藏目标 IP。

## 7 层和 4 层

### TCP/IP 分层

抽象出来的几个步骤，每个步骤是一层的意思，发送一个数据给目标。
应用层——发送什么格式的数据，对方怎么解读数据等等，这是应用层的逻辑，Http 在这里。
传输层——要发送数据了，发送给对面的哪个程序接收了？TCP 层，同时保证数据的完整。
网络层——寻找目标位置，IP 协议在这里。
连接层——Mac 地址层，用 IP 转化为 Mac 地址查找目的地。

### OSI

历史原因，TCP/IP 协议虽然主导地位，但是当初各种协议太混乱了，需要统一标准，出现了统一的标准。
7 层协议，本质上是对 TCP/IP 协议的补充以及细粒度分层。
第一层，补充了物理层，比如光纤网卡等等。
2 层数据链路层等同于 TCP/IP 的 连接层，MAC 层。
3 层网络层=对应的网际层，IP 层。
4 层传输层一样的，TCP 层。
5 层，会话层，维持网络连接状态，保持 会话，同步。
6 层，表示层，把数据转化为合适的可理解的语法和语义。
7 层，应用层，面向具体的应用传输数据。

把物理层补全了，把 HTTP 应用层的功能细化了，拆出来 3 个层。

4 层的均衡负载说的是传输层上对后端服务器的负载均衡。
7 层的负载均衡，应用层上看到的是 HTTP 协议，解析 HTTP 报文，然后适当策略转发给后端服务器的。

### TCP/IP 协议的工作方式

是个洋葱模型，先进后出，每一层只关注这一层的对应的事要怎么做。

-  应用层打包数据，给了 TCP 层。
-  TCP 层打包数据，加上 TCP 的头，给了 IP 层。
-  IP 层打包数据，加 IP 头，给了 MAC 层。
-  MAC 层打包数据加了 MAC 头，开始寻址，在 MAC 层传递数据。
-  找到了对应的 MAC，对应的 MAC 拆解 MAC 包，暴露了 IP 包，传给 IP 层。
-  IP 层拿到 IP 包，拆解包得到 TCP 包，传给 TCP 层。
-  TCP 层拆解包，，，，
-  应用层拆解，，，

## 发送请求的大致流程

-  浏览器准备发送请求行
-  先在浏览器缓存
   里找有木有对应的请求记录和请求数据的缓存，有不过期，就终止请求了。
-  没有缓存可以偷懒，
   先要建立 TCP 连接。
-  TCP 连接，先要 DNS 查询，定位到 IP 地址。DNS 也有缓存的，可以本地，可以网络路由器之间。
-  拿到 IP 之后，开始三次握手，建立连接。
-  然后发送请求行，再发送请求头，请求体。
-  服务器发送 响应行，再发送响应头，体。
-  然后看请求头或响应头上有木有 Connection:Keep-Alive，可以满足继续请求这个服务器的其他资源，避免多次 TCP 的开销。
-  然后就是第四次握手，断开连接。
-  重定向是再浏览器接收到响应头之后，拿到 301 状态码以及 location 字段之后，重新发送请求的。

## 缓存机制

DNS 缓存，为了很快拿到 IP 地址，不多说了。
对于返回来的数据，如何做缓存？
响应头中的 Catch-Control:Max-age=2000，意思是 2000 秒之后就需要重新请求资源了。2000 秒内，请求资源就会返回缓存里的数据。
2000 秒后，在请求就会发冲去，请求头上带 If-None-Match:"4f80f-13c-3a1xb12a"。
服务器收到请求 了，会根据 If-None-Match 的值做判断，是否数据更新了，没更新就返回 304.
否则就返回最新数据。浏览器收到之后，都会把当前的数据的 age 设置为 0。

### cookie 登录可以缓存

浏览器发起请求，服务器返回请求，响应头有 Set
Cookie:uid=23234234
浏览器就会 set cookie。
下次再发送到对应的
host 端，请求头上自动添加 cookie 字段。
服务器端收到
请求之后，看到 cookie 字段就会自查有木有这个用户，这个用户的状态是否是登录态。

## 域名系统

域名只是为了对人友好，对搜索引擎友好的。
是对 IP 地址的一层抽象。
假如你在浏览器输入了域名内容的 URL，那会对域名进行域名解析。
先看浏览器有木有缓存，再看本地电脑有木有缓存，再看路由器有木有缓存，
然后就会进行 DNS 查询，一开始的流程是，从根域名服务器查
顶级域名所在的服务器，然后到顶级域名服务器查询次级域名服务器，一级一级地查。
类似于作用域，图书馆的检索系统，等等。直到最拿到 IP。
DNS 除了缓存之外，还有其他的各个大厂自己的非权威的服务器 DNS 代理缓存 IP。
